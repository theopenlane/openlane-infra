---
apiVersion: v1
kind: ConfigMap
metadata:
  name: riverboat-config
  namespace: openlane
  labels:
    app: riverboat
    component: config
  annotations:
    # This checksum will trigger deployment restarts when the ConfigMap changes
    checksum/config: {{ .Values | toYaml | sha256sum }}
data:
  RIVERBOAT_REFRESHINTERVAL: {{ .Values.riverboat.refreshInterval }}
  RIVERBOAT_RIVER_QUEUES: {{ .Values.riverboat.queues }}

  # email worker
  RIVERBOAT_RIVER_WORKERS_EMAILWORKER_CONFIG_FROMEMAIL: {{ .Values.riverboat.workers.emailWorker.fromEmail }}
  RIVERBOAT_RIVER_WORKERS_EMAILWORKER_CONFIG_DEVMODE: {{ .Values.riverboat.workers.emailWorker.devMode }}
  RIVERBOAT_RIVER_WORKERS_EMAILWORKER_CONFIG_TESTDIR: {{ .Values.riverboat.workers.emailWorker.testDir  }}

  # export worker
  RIVERBOAT_RIVER_WORKERS_DELETEEXPORTCONTENTWORKER_CONFIG_ENABLED: {{ .Values.riverboat.workers.deleteExportContentWorker.enabled }}
  RIVERBOAT_RIVER_WORKERS_DELETEEXPORTCONTENTWORKER_CONFIG_INTERVAL: {{ .Values.riverboat.workers.deleteExportContentWorker.interval }}
  RIVERBOAT_RIVER_WORKERS_DELETEEXPORTCONTENTWORKER_CONFIG_CUTOFFDURATION: {{ .Values.riverboat.workers.deleteExportContentWorker.cutoffDuration }}
  RIVERBOAT_RIVER_WORKERS_EXPORTCONTENTWORKER_CONFIG_ENABLED: {{ .Values.riverboat.workers.exportContentWorker.enabled }}
  {{- if .Values.riverboat.workers.exportContentWorker.openlaneAPIHost }}
  RIVERBOAT_RIVER_WORKERS_EXPORTCONTENTWORKER_CONFIG_OPENLANEAPIHOST: {{ .Values.riverboat.workers.exportContentWorker.openlaneAPIHost }}
  {{- else if .Values.domain }}
  RIVERBOAT_RIVER_WORKERS_EXPORTCONTENTWORKER_CONFIG_OPENLANEAPIHOST: "https://api.{{ .Values.domain }}"
  {{- end }}
  {{ if .Values.riverboat.workers.deleteExportContentWorker.openlaneAPIHost }}
  RIVERBOAT_RIVER_WORKERS_DELETEEXPORTCONTENTWORKER_CONFIG_OPENLANEAPIHOST: {{ .Values.riverboat.workers.deleteExportContentWorker.openlaneAPIHost }}
  {{- else if .Values.domain }}
  RIVERBOAT_RIVER_WORKERS_DELETEEXPORTCONTENTWORKER_CONFIG_OPENLANEAPIHOST: "https://api.{{ .Values.domain }}"
  {{- end }}

  # custom domain workers 
  RIVERBOAT_RIVER_WORKERS_CREATECUSTOMDOMAINWORKER_CONFIG_ENABLED: {{ .Values.riverboat.workers.customDomainWorker.enabled }}
  RIVERBOAT_RIVER_WORKERS_DELETECUSTOMDOMAINWORKER_CONFIG_ENABLED: {{ .Values.riverboat.workers.customDomainWorker.enabled }}
  RIVERBOAT_RIVER_WORKERS_VALIDATECUSTOMDOMAINWORKER_CONFIG_ENABLED: {{ .Values.riverboat.workers.customDomainWorker.enabled }}

  {{- if .Values.riverboat.workers.customDomainWorker.openlaneAPIHost }}
  RIVERBOAT_RIVER_WORKERS_CREATECUSTOMDOMAINWORKER_CONFIG_OPENLANEAPIHOST: {{ .Values.riverboat.workers.customDomainWorker.openlaneAPIHost }}
  RIVERBOAT_RIVER_WORKERS_DELETECUSTOMDOMAINWORKER_CONFIG_OPENLANEAPIHOST: {{ .Values.riverboat.workers.customDomainWorker.openlaneAPIHost }}
  RIVERBOAT_RIVER_WORKERS_VALIDATECUSTOMDOMAINWORKER_CONFIG_OPENLANEAPIHOST: {{ .Values.riverboat.workers.customDomainWorker.openlaneAPIHost }}
  {{- else if .Values.domain }}
  RIVERBOAT_RIVER_WORKERS_CREATECUSTOMDOMAINWORKER_CONFIG_OPENLANEAPIHOST: "https://api.{{ .Values.domain }}"
  RIVERBOAT_RIVER_WORKERS_DELETECUSTOMDOMAINWORKER_CONFIG_OPENLANEAPIHOST: "https://api.{{ .Values.domain }}"
  RIVERBOAT_RIVER_WORKERS_VALIDATECUSTOMDOMAINWORKER_CONFIG_OPENLANEAPIHOST: "https://api.{{ .Values.domain }}"
  {{- end }}

  # database workers
  RIVERBOAT_RIVER_WORKERS_DATABASEWORKER_CONFIG_ENABLED: {{ .Values.riverboat.workers.databaseWorker.enabled }}
  RIVERBOAT_RIVER_WORKERS_DATABASEWORKER_CONFIG_BASEURL: {{ .Values.riverboat.workers.databaseWorker.baseUrl }}
  RIVERBOAT_RIVER_WORKERS_DATABASEWORKER_CONFIG_ENDPOINT: {{ .Values.riverboat.workers.databaseWorker.endpoint  }}
  RIVERBOAT_RIVER_WORKERS_DATABASEWORKER_CONFIG_DEBUG: {{ .Values.riverboat.workers.databaseWorker.debug }}
