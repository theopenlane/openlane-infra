# charts/openlane-gcp-bootstrap/values-prod.yaml
# --- Environment-Specific Overrides for 'prod' ---

env:
  name: "prod"
  capitalizedName: "Prod"

orgId: "YOUR_PROD_GCP_ORGANIZATION_ID" # IMPORTANT: Replace with Prod Org ID
billingAccountId: "YOUR_PROD_BILLING_ACCOUNT_ID" # IMPORTANT: Replace with Prod Billing Account
commonAppConfig:
  primaryRegion: "us-east4" # Prod might use a specific region
  gkeCluster:
    nodeCount: 3 # More nodes
    machineType: "e2-standard-4" # Beefier machines
    releaseChannel: "REGULAR"
    nodePools:
      - name: "gke-primary-prod" # Distinct node pool for Prod
        nodeCount: 3 # More nodes in Prod
        machineType: "e2-standard-4" # Beefier machine type for Prod
        autoscaling: { enabled: true, minNodeCount: 3, maxNodeCount: 10 }
        oauthScopes:
        - "https://www.googleapis.com/auth/devstorage.read_only"
        - "https://www.googleapis.com/auth/logging.write"
        - "https://www.googleapis.com/auth/monitoring"
        - "https://www.googleapis.com/auth/service.management.readonly"
        - "https://www.googleapis.com/auth/servicecontrol"
        - "https://www.googleapis.com/auth/trace.append"
    addonsConfig:
      horizontalPodAutoscaling: { disabled: false } # Enable HPA in Prod
      httpLoadBalancing: { disabled: false } # Enable HTTP LB in Prod
      networkPolicyConfig: { disabled: false } # Enable Network Policy in Prod
      configConnectorConfig: { enabled: true } # Enable Config Connector in Prod
      dnsCacheConfig: { enabled: true } # Enable DNS Cache in Prod
      gcePersistentDiskCsiDriverConfig: { enabled: true } # Enable GCE PD CSI Driver in Prod
      gcsFuseCsiDriverConfig: { enabled: true } # Enable GCS FUSE CSI Driver in Prod
      gcpFilestoreCsiDriverConfig: { enabled: true } # Enable GCP Filestore CSI Driver in Prod
      gkeBackupAgentConfig: { enabled: true } # Enable GKE Backup Agent in Prod
    authenticatorGroupsConfig:
      securityGroup: "gke-security-groups@theopenlane.io"
    datapathProvider: "ADVANCED_DATAPATH" # Use advanced datapath for Prod
    enableAutopilot: true
    enableIntranodeVisibility: true
    enableShieldedNodes: true
    identityServiceConfig: { enabled: true } # Enable Identity Service in Prod
    # REVIEW
    ipAllocationPolicy:
      useIpAliases: true
      enabled: true
      additionalPodRangesConfig:
        podRangeNames:
          - name: "gke-pods-prod"
          - name: "gke-services-prod"
      clusterIpv4CidrBlock: "10.0.0.0/16"
      clusterSecondaryRangeName:
      servicesIpv4CidrBlock: "10.1.0.0/16"
      servicesSecondaryRangeName:
    masterAuthorizedNetworksConfig: { enabled: true, cidrBlocks: [{ cidrBlock: "203.0.113.0/24", displayName: "CI/CD Range" }] }
    networkRef:
      name: "openlane-shared-vpc-prod" 
    subnetworkRef:
      external: "openlane-shared-vpc-subnetwork"
    loggingConfig:
      enabled: true # Enable logging in Prod
      enableComponents: ["SYSTEM_COMPONENTS", "API_SERVER", "CONTROLLER_MANAGER", "SCHEDULER", "WORKLOADS"] # Enable all logging components in Prod
    monitoringConfig:
      advancedDatapathObservabilityConfig:
      - enableMetrics: true
      enableComponents:
      - SYSTEM_COMPONENTS
      - STORAGE
      - HPA
      - POD
      - DAEMONSET
      - DEPLOYMENT
      - STATEFULSET
      - JOBSET
      - CADVISOR
      - KUBELET
      - DCGM
      managedPrometheus:
        enabled: true
      privateClusterConfig:
        enablePrivateNodes: true
        masterGlobalAccessConfig:
          enabled: false
        privateEndpoint: 10.128.0.2
        publicEndpoint: 34.9.75.254 # Example public endpoint for Prod
      serviceExternalIpsConfig: { enabled: true } # Enable external IPs for services in Prod
  bigquery:
    cmekEnabled: true # CMEK for Prod
  storage:
    cmekEnabled: true # CMEK for Prod
  cloudsql:
    enabled: false
    instanceName: "openlane-prod-sql"
    version: "POSTGRES_14"
    tier: "db-f1-micro"
    cmekEnabled: false
  memorystore:
    enabled: false
    instanceName: "default-redis"
    tier: "BASIC"
    memorySizeGb: 1
  dnsZone:
    enabled: false
    name: "default-zone"
    domainName: "default.com."

# --- PROJECT TYPE ACTIVATION AND CONFIGURATION FOR 'PROD' ENVIRONMENT ---

sharedVpcHost:
  enabled: true
  project:
    name: "openlane-prod-network-project"
    id: ""
    gcpProjectName: "openlane-prod-network-project"
    folderRef: "folders/openlane-prod-network-folder"
  network:
    name: "prod-shared-vpc"
    subnets: # Use distinct CIDR for Prod network
      gkePrimary: { name: "prod-gke-subnet", ipCidrRange: "10.1.0.0/20", privateIpGoogleAccess: true }
      gkePodsSecondary: { name: "prod-gke-podsubet-secondary", ipCidrRange: "10.1.32.0/16" }
      gkeServicesSecondary: { name: "prod-gke-servicesubnet-secondary", ipCidrRange: "10.1.16.0/20" }
      internalApps: { name: "prod-apps-subnet-primary", ipCidrRange: "10.1.48.0/20", privateIpGoogleAccess: true }
  serviceProjects:
    appProject: { enabled: true, name: "openlane-prod-app-project" }
    loggingProject: { enabled: true, name: "openlane-prod-logs-project" }

appProject:
  enabled: true
  project:
    name: "openlane-prod-app-project"
    id: ""
    gcpProjectName: "openlane-prod-app-project"
    folderRef: "folders/openlane-prod-app-folder"
  apis: ["compute.googleapis.com", "container.googleapis.com", "bigquery.googleapis.com", "storage.googleapis.com", "sqladmin.googleapis.com", "redis.googleapis.com", "dns.googleapis.com"]
  gkeCluster: { enabled: true, name: "prod-app-gke-central1" }
  bigquery: { enabled: true, name: "prod-app-bigquery-central1" }
  storage: { enabled: true, name: "prod-app-data-bucket" }
  cloudsql: { enabled: true, instanceName: "prod-app-cloudsql" }
  memorystore: { enabled: true, instanceName: "prod-app-redis" }
  dnsZone: { enabled: true, name: "prod-app-dnszone", domainName: "prod.openlane.com." }

loggingProject:
  enabled: true
  project:
    name: "openlane-prod-logs-project"
    id: ""
    gcpProjectName: "openlane-prod-logs-project"
    folderRef: "folders/openlane-prod-logs-folder"
  logSinks:
    orgAudit:
      enabled: true
      destinationBucketName: "openlane-prod-logs-bucket"
      destinationDatasetName: "openlane_central_logs_dataset_prod"

billingProject:
  enabled: true
  project:
    name: "openlane-prod-billing-project"
    id: ""
    gcpProjectName: "openlane-prod-billing-project"
    folderRef: "folders/openlane-prod-billing-folder"

folders:
  prod:
    displayName: prod
    parentType: organization
    parent: 319013011373
    billingAccountRef: 01AC20-2CEAE3-8BB367
    id: ""
    enableAPIs:
    - iam.googleapis.com
    - serviceusage.googleapis.com
    - compute.googleapis.com
    - container.googleapis.com
    - servicenetworking.googleapis.com
    - logging.googleapis.com
    - monitoring.googleapis.com
    - sqladmin.googleapis.com
    - redis.googleapis.com
    - secretmanager.googleapis.com
    - cloudkms.googleapis.com
    - cloudtrace.googleapis.com
    - artifactregistry.googleapis.com
    - anthosidentityservice.googleapis.com
    - analyticshub.googleapis.com
    - anthosgke.googleapis.com
    - autoscaling.googleapis.com
    - anthosconfigmanagement.googleapis.com
    - bigquery.googleapis.com
    - anthos.googleapis.com
    - anthospolicycontroller.googleapis.com
    - bigqueryconnection.googleapis.com
    - bigquerystorage.googleapis.com
    - config.googleapis.com
    - bigquerymigration.googleapis.com
    - cloudidentity.googleapis.com
    - auditmanager.googleapis.com
    - cloudbuild.googleapis.com
    - clouddeploy.googleapis.com
    - cloudasset.googleapis.com
    - apphub.googleapis.com
    - bigquerydatapolicy.googleapis.com
    - deploymentmanager.googleapis.com
    - containerscanning.googleapis.com
    - cloudresourcemanager.googleapis.com
    - containerthreatdetection.googleapis.com
    - containerfilesystem.googleapis.com
    - identitytoolkit.googleapis.com
    - cloudapis.googleapis.com
    - domains.googleapis.com
    - containerregistry.googleapis.com
    - networkmanagement.googleapis.com
    - dns.googleapis.com
    - containeranalysis.googleapis.com
    - endpoints.googleapis.com
    - recommender.googleapis.com
    - datastore.googleapis.com
    - trafficdirector.googleapis.com
    - storage.googleapis.com
    - servicemanagement.googleapis.com
    - iap.googleapis.com
    - sqladmin.googleapis.com
    - containersecurity.googleapis.com
    - gkeconnect.googleapis.com
    - gkehub.googleapis.com
    - iamcredentials.googleapis.com
    - networkconnectivity.googleapis.com
    - firewallinsights.googleapis.com
    - krmapihosting.googleapis.com
    - networksecurity.googleapis.com
    - pubsub.googleapis.com
    - sql-component.googleapis.com
    - servicedirectory.googleapis.com
    - serviceusage.googleapis.com
    - networkservices.googleapis.com
    - servicehealth.googleapis.com
    - storage-component.googleapis.com
    - orgpolicy.googleapis.com
    - servicenetworking.googleapis.com
    - privilegedaccessmanager.googleapis.com
    - storage-api.googleapis.com
  networking:
    displayName: networking
    parentType: folder
    parent: prod
    id: ""
  sharedInfra:
    displayName: sharedInfra
    parentType: folder
    parent: prod
    id: ""
  signals:
    displayName: signals
    parentType: folder
    parent: prod
    id: ""
  billing:
    displayName: billing
    parentType: folder
    parent: prod
    id: ""
  apps:
    displayName: apps
    parentType: folder
    parent: prod
    id: ""

projects:
  prod-bootstrap-project:
    displayName: prod-bootstrap-project
    parentType: folder
    parent: prod/bootstrap
    id: ''
    type: miscProject
  prod-shared-network-project:
    displayName: prod-shared-network-project
    parentType: folder
    parent: prod/networking
    id: ''
    type: sharedVpcHost
  prod-shared-kms:
    displayName: prod-shared-kms
    parentType: folder
    parent: prod/sharedInfra
    id: ''
    apis:
    - cloudkms.googleapis.com
    type: sharedInfrastructureProject
  prod-shared-secrets:
    displayName: prod-shared-secrets
    parentType: folder
    parent: prod/sharedInfra
    id: ''
    type: sharedInfrastructureProject
  prod-signals-logging:
    displayName: prod-signals-logging
    parentType: folder
    parent: prod/signals
    id: ''
    type: loggingProject
  prod-signals-monitoring:
    displayName: prod-signals-monitoring
    parentType: folder
    parent: prod/signals
    id: ''
    type: loggingProject
  prod-billing-project:
    displayName: prod-billing-project
    parentType: folder
    parent: prod/billing
    id: ''
    type: billingProject
  prod-apps-project:
    displayName: prod-apps-project
    parentType: folder
    parent: prod/apps
    id: ''
    type: appProject
