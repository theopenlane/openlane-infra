# charts/openlane-gcp-bootstrap/values.yaml
# Global Configuration Blueprint
# This defines the structure and default settings for all project types.
# Specific environment overrides will be applied via values-dev.yaml / values-prod.yaml.

# --- Global Settings ---
orgId: "YOUR_GCP_ORGANIZATION_ID_DEFAULT" # Placeholder: MUST BE OVERRIDDEN per env
billingAccountId: "YOUR_BILLING_ACCOUNT_ID_DEFAULT" # Placeholder: MUST BE OVERRIDDEN per env
repoURL: "https://github.com/theopenlane/openlane-infra" # Your Git repository URL

# Folders definition (common names, IDs need hydration)
folders:
  openlaneOrg: { name: "openlane-org", id: "" } # Root organizational folder
  appEnv: { name: "app", id: "" } # Base name for application environment folders (e.g., openlane-org-app-dev)
  sharedInfraEnv: { name: "shared-infra", id: "" } # Base name for shared infra environment folders
  loggingEnv: { name: "logging", id: "" } # Base name for logging environment folders
  billingEnv: { name: "billing", id: "" } # Base name for billing environment folders

# --- Organization-Level Policies & Services (Always apply if enabled) ---
orgPolicies: # Control which org policies are applied.
  disableServiceAccountKeyCreation: true
  skipDefaultNetworkCreation: false # Set to false if you are creating default networks for tests, otherwise true
  disableSerialPortAccess: true
  resourceLocations: { enabled: true, allowedLocations: ["us-east4", "us-central1"] }
  vmExternalIpAccess: { enabled: true, policyType: "DENY_ALL" }
  gkePrivateCluster: { enabled: true }

kms: # Global KMS configuration blueprint
  enabled: true
  keyRingName: "openlane-default-keyring"
  keyName: "openlane-default-key"
  location: "us-east4" # Default KMS key location

# --- COMMON APP CONFIG (Default settings for all application resources across environments) ---
# These values apply unless specifically overridden per specific project type.
commonAppConfig:
  primaryRegion: "us-east4" # Default primary region for compute resources
  gkeCluster:
    enabled: false # Default state for GKE clusters in app projects
    nodeCount: 1
    machineType: "e2-standard-2"
    workloadIdentityEnabled: true
    masterAuthorizedNetworksConfig: { enabled: false, cidrBlocks: [] }
    nodePools: []
  bigquery:
    enabled: false # Default state for BigQuery datasets in app projects
    location: "us-east4"
    cmekEnabled: false
  storage:
    enabled: false # Default state for Storage buckets in app projects
    location: "us-east4"
    cmekEnabled: false
  cloudsql:
    enabled: false
    instanceName: "default-sql"
    version: "POSTGRES_14"
    tier: "db-f1-micro"
    cmekEnabled: false
  memorystore:
    enabled: false
    instanceName: "default-redis"
    tier: "BASIC"
    memorySizeGb: 1
  dnsZone:
    enabled: false
    name: "default-zone"
    domainName: "default.com."

# --- PROJECT TYPE BLUEPRINTS ---
# These define the default structure and properties for each *type* of project.
# They are not enabled by default. `values-dev.yaml` / `values-prod.yaml` will *enable* and *override* these.

sharedVpcHost: # Blueprint for a shared VPC host project instance
  enabled: false # Must be enabled in values-dev/prod.yaml
  project: # KCC Project resource details
    name: "openlane-shared-vpc-host" # Base Project ID
    id: "" # Hydrated numerical project ID
    gcpProjectName: "Openlane Shared VPC Host" # Base Display Name
    apis: ["compute.googleapis.com", "servicenetworking.googleapis.com", "cloudresourcemanager.googleapis.com", "cloudkms.googleapis.com"]
  network: # Shared VPC network details
    name: "openlane-shared-vpc" # Network name base
    subnets:
      gkePrimary: { name: "gke-primary", ipCidrRange: "10.0.0.0/20", privateIpGoogleAccess: true }
      gkePodsSecondary: { name: "gke-pods", ipCidrRange: "10.0.32.0/16" }
      gkeServicesSecondary: { name: "gke-services", ipCidrRange: "10.0.16.0/20" }
      internalApps: { name: "internal-apps", ipCidrRange: "10.0.48.0/20", privateIpGoogleAccess: true }
    firewallRules: { allowIAPSsh: { enabled: true, sourceRanges: ["35.235.240.0/20"], targetTags: ["ssh-via-iap"], ports: [{ protocol: "tcp", ports: ["22"] }] } }
  serviceProjects: {} # Empty by default, populated in env-specific values

appProject: # Blueprint for an application project instance. Inherits from commonAppConfig.
  enabled: false
  project:
    name: "openlane-app" # Base Project ID
    id: "" # Hydrated
    gcpProjectName: "Openlane Application" # Base Display Name
    apis: ["compute.googleapis.com", "container.googleapis.com", "bigquery.googleapis.com", "storage.googleapis.com", "sqladmin.googleapis.com", "redis.googleapis.com", "dns.googleapis.com"]
  # Resource config defaults - will be merged with commonAppConfig and then instance-specific values
  gkeCluster: {} 
  bigquery: {} 
  storage: {} 
  cloudsql: {} 
  memorystore: {} 
  dnsZone: {} 

loggingProject: # Blueprint for a centralized logging project instance
  enabled: false
  project:
    name: "openlane-logs"
    id: "" # Hydrated
    gcpProjectName: "Openlane Central Logging"
    apis: ["logging.googleapis.com", "bigquery.googleapis.com", "storage.googleapis.com"]
  logSinks:
    orgAudit: { enabled: true, destinationBucketName: "openlane-central-logs-bucket", destinationDatasetName: "openlane_central_logs_dataset" }

billingProject: # Blueprint for a centralized billing project instance
  enabled: false
  project:
    name: "openlane-billing"
    id: "" # Hydrated
    gcpProjectName: "Openlane Billing Admin"
    apis: ["cloudbilling.googleapis.com"]

kmsProject: # Blueprint for a dedicated KMS project instance
  enabled: false
  project:
    name: "openlane-kms"
    id: "" # Hydrated
    gcpProjectName: "Openlane Central KMS"
    folderRef: "folders/{{ .Values.folders.openlaneOrg.id }}" # Place under root org folder
    apis: ["cloudkms.googleapis.com"]