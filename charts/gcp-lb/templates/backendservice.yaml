{{- if .Values.enabled }}
apiVersion: compute.cnrm.cloud.google.com/v1beta1
kind: ComputeBackendService
metadata:
  name: {{ .Values.backendService.name | quote }}
  namespace: {{ include "gcp-lb.namespace" . }}
  annotations:
    cnrm.cloud.google.com/project-id: {{ .Values.projectId | quote }}
spec:
  protocol: {{ .Values.backendService.protocol | quote }}
  portName: {{ .Values.backendService.portName | quote }}
  backends:
{{- range .Values.backendService.backends }}
    - group:
        external: {{ .group.external | quote }}
      balancingMode: {{ .balancingMode | quote }}
      maxUtilization: {{ .maxUtilization }}
      capacityScaler: {{ .capacityScaler }}
{{- end }}
  healthChecks:
    - {{ include "gcp-lb.healthcheckName" . | quote }}
{{- end }}
